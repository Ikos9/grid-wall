(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?module.exports=e():typeof define==="function"&&define.amd?define(e):(t=t||self,t.ReflowGrid=e())})(this,function(){"use strict";function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}var i=e(function(t,e){Object.defineProperty(e,"__esModule",{value:true});var i=function(){function t(e){var i=this;this.addAfterStyle=function(e){if(e.target instanceof HTMLElement){t.addStyles(e.target,i.afterStyle);e.target.setAttribute("data-rg-transition","true");e.target.removeEventListener("transitionend",i.addAfterStyle,true)}};if(!e)throw new Error("Missing mandatory parameters!");var n=e.container,r=e.childrenWidthInPx,o=e.enableResize,h=e.resizeDebounceInMs,s=e.margin,a=e.insertStyle,d=a===void 0?{}:a,l=e.beforeStyle,c=l===void 0?{}:l,u=e.afterStyle,f=u===void 0?{}:u;this.missingParameter({container:n,childrenWidthInPx:r});this.container=n;this.childrenWidth=r;this.margin=s||"center";this.columnsHeight=[];this.childrenHeights={};this.childLastId=0;this.enableResize=o||false;this.resizeDebounceInMs=h||100;this.containerClassName="rg-container";this.insertStyle=d;this.beforeStyle=c;this.afterStyle=f;this.addStyleToDOM();this.children=this.getChildren();this.container.classList.add(this.containerClassName);this.containerWidth=this.container.clientWidth;this.columnsCount=Math.floor(this.containerWidth/this.childrenWidth);this.setChildrenWidth();this.setChildrenHeight();this.setInitialChildrenTransition();this.listenToResize();this.marginWidth=this.calculateMargin();this.addMutationObserverToContainer();this.addMutationObserverToChildren();this.reflow()}t.prototype.missingParameter=function(t){var e=[];Object.entries(t).forEach(function(t){var i=t[0],n=t[1];if(!n)e.push(i)});if(e.length>0){var i="parameter"+(e.length>1?"s":"");var n="Missing "+e.length+" mandatory "+i+":";e.forEach(function(t){return n+="\n  "+t});throw new Error(n)}};t.prototype.calculateMargin=function(){if(this.margin==="right")return 0;if(this.columnsCount<=1)return 0;var t=this.children.length>this.columnsCount?this.columnsCount:this.children.length;var e=this.containerWidth-t*this.childrenWidth;if(this.margin==="left")return e;return Math.floor(e/2)};t.debounce=function(t,e){var i;return function(){clearTimeout(i);i=setTimeout(t,e)}};t.prototype.listenToResize=function(){var e=this;if(this.enableResize){var i=this.resizeDebounceInMs;window.addEventListener("resize",t.debounce(function(){return e.resize(e.container.clientWidth)},i))}};t.prototype.setChildrenHeight=function(){var t=this;this.children.forEach(function(e){var i=e.getAttribute("data-rg-id");if(!i){t.childLastId=t.childLastId+1;i=t.childLastId.toString();e.setAttribute("data-rg-id",i)}t.childrenHeights[i]=e.offsetHeight})};t.prototype.setInitialChildrenTransition=function(){var e=this;this.children.forEach(function(i){t.addStyles(i,e.insertStyle)})};t.prototype.resetColumnsHeight=function(){this.columnsHeight=[]};t.prototype.addStyleToDOM=function(){var t=document.querySelector("head");if(t){var e=document.createElement("style");e.id="reflow-grid-style";var i=document.createTextNode("/* reflow grid */"+("."+this.containerClassName+"{")+"  box-sizing:content-box;"+"}"+("."+this.containerClassName+">*{")+"  box-sizing:border-box;"+"  position:absolute;"+"}");e.appendChild(i);t.appendChild(e)}};t.setWidth=function(t,e){t.style.width=e+"px"};t.addStyles=function(t,e){for(var i in e){if(t.style.hasOwnProperty(i)){t.style[i]=e[i]}}};t.prototype.getChildren=function(){var t=[];if(this.container.children.length>0){Array.from(this.container.children).forEach(function(e){if(e instanceof HTMLElement){t.push(e)}})}return t};t.prototype.setChildrenWidth=function(){var e=this;if(this.children.length>0){this.children.forEach(function(i){t.setWidth(i,e.childrenWidth)})}};t.prototype.addMutationObserverToContainer=function(){var t=this;var e=new MutationObserver(function(e){return t.handleContainerMutation(e)});e.observe(this.container,{childList:true})};t.prototype.addMutationObserverToChildren=function(){var t=this;if(this.children.length>0){this.children.forEach(function(e){var i=new MutationObserver(function(e){return t.handleChildrenMutation(e)});i.observe(e,{attributes:true})})}};t.prototype.getLowerColumn=function(){var t={index:0,height:0};if(this.columnsHeight.length>0){this.columnsHeight.forEach(function(e,i){if(t.height===0||t.height>e){t.height=e;t.index=i}})}return t};t.getMaxHeight=function(t){return Math.max.apply(Math,t)};t.prototype.reflow=function(){var e=this;this.resetColumnsHeight();this.marginWidth=this.calculateMargin();this.children.forEach(function(i,n){var r=n;var o="translate("+(r*e.childrenWidth+e.marginWidth)+"px, 0px)";if((r+1)*e.childrenWidth>=e.containerWidth){var h=e.getLowerColumn();r=h.index;var s=r*e.childrenWidth;o="translate("+(e.marginWidth+s)+"px, "+h.height+"px)"}e.columnsHeight[r]=Number.isInteger(e.columnsHeight[r])?e.columnsHeight[r]+i.offsetHeight:i.offsetHeight;if(!i.getAttribute("data-rg-transition")){t.addStyles(i,e.beforeStyle);i.addEventListener("transitionend",e.addAfterStyle,true)}if(i.style.transform!==o)i.style.transform=o});this.container.style.height=t.getMaxHeight(this.columnsHeight)+"px";this.setChildrenHeight()};t.prototype.resize=function(t){if(!t&&!Number.isNaN(t)){throw new Error("Width must be a number and more than 0")}this.containerWidth=t;this.columnsCount=Math.floor(this.containerWidth/this.childrenWidth);this.reflow()};t.prototype.handleChildrenMutation=function(t,e){var i=this;t.forEach(function(t){var e=t.target;var n=e.getAttribute("data-rg-id");if(n){var r=i.childrenHeights[n];if(r!==e.offsetHeight){i.reflow()}}});if(e&&typeof e==="function")e()};t.prototype.handleContainerMutation=function(e,i){var n=this;e.forEach(function(e){if(e.type==="childList"){e.addedNodes.forEach(function(e){if(e instanceof HTMLElement){t.addStyles(e,n.insertStyle);t.setWidth(e,n.childrenWidth)}});n.children=n.getChildren();n.reflow()}});if(i&&typeof i==="function")i()};return t}();e.default=i});var n=t(i);return n});